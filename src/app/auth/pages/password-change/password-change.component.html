<section class="auth-scope auth-container">
  <aside class="auth-left-panel">
    <div class="auth-brand">
      <div class="auth-brand-title">Vida Longa Flix<br />Saúde</div>
      <div class="auth-brand-welcome">Redefina sua senha</div>
      <div class="auth-brand-link">Segurança em primeiro lugar</div>
    </div>
  </aside>

  <main class="auth-right-panel">
    <div class="auth-card">
      
      @if (validatingToken) {
        <div class="loading-state">
          <div class="spinner"></div>
          <p>Validando link...</p>
        </div>
      }

      @if (!validatingToken && !tokenValid) {
        <div class="error-state">
          <mat-icon class="error-icon">error_outline</mat-icon>
          <h2>Link inválido</h2>
          <p>Este link pode ter expirado ou já foi utilizado.</p>
          <p class="redirect-info">Redirecionando para o login...</p>
        </div>
      }

      @if (!validatingToken && tokenValid) {
        <div class="auth-login-box">
          <h2>Redefinir senha</h2>
          <p class="subtitle">Digite sua nova senha abaixo</p>

          <form [formGroup]="form" (ngSubmit)="change()">
            <div class="auth-form-container">
              
              <app-form-field
                label="Nova Senha"
                placeholder="Digite a nova senha"
                formControlName="newPassword"
                type="password"
                icon="lock"
                autocomplete="new-password"
                [maxlength]="128"
                [showCounter]="true"
                [error]="fieldError('newPassword')"
              ></app-form-field>

              <app-password-strength-indicator
                [password]="currentPassword"
                [showRequirements]="true"
              ></app-password-strength-indicator>

              <app-form-field
                label="Confirmar Nova Senha"
                placeholder="Digite novamente"
                formControlName="confirmPassword"
                type="password"
                icon="lock"
                autocomplete="new-password"
                [maxlength]="128"
                [showCounter]="false"
                [error]="fieldError('confirmPassword')"
              ></app-form-field>

            </div>

            <app-primary-button
              text="Redefinir senha"
              [disabled]="loading"
              type="submit"
            ></app-primary-button>

            <div class="back-link">
              <a routerLink="/login">← Voltar para o login</a>
            </div>
          </form>
        </div>
      }

    </div>
  </main>
</section>