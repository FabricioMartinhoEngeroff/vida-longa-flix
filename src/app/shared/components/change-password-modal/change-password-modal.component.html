<div class="backdrop" [class.visible]="open" (click)="onClose()">
  <div class="modal" [class.visible]="open" (click)="$event.stopPropagation()">
    
    <button class="close-btn" (click)="onClose()" type="button">
      <mat-icon>close</mat-icon>
    </button>

    <h2 class="title">Mudar senha</h2>

    <form (ngSubmit)="onConfirm()">
      
      <div class="field">
        <label for="currentPassword">Senha Atual *</label>
        <div class="input-wrapper">
          <input
            id="currentPassword"
            [type]="showCurrentPassword ? 'text' : 'password'"
            [(ngModel)]="currentPassword"
            name="currentPassword"
            placeholder="Digite sua senha atual"
            autocomplete="current-password"
          />
          <button
            class="eye-btn"
            type="button"
            (click)="toggleShowPassword('current')"
          >
            <mat-icon>{{ showCurrentPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
          </button>
        </div>
      </div>

      <div class="field">
        <label for="newPassword">Nova Senha *</label>
        <div class="input-wrapper">
          <input
            id="newPassword"
            [type]="showNewPassword ? 'text' : 'password'"
            [(ngModel)]="newPassword"
            name="newPassword"
            placeholder="Digite a nova senha"
            autocomplete="new-password"
          />
          <button
            class="eye-btn"
            type="button"
            (click)="toggleShowPassword('new')"
          >
            <mat-icon>{{ showNewPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
          </button>
        </div>
        
        @if (newPassword.length > 0) {
          <app-password-strength-indicator 
            [password]="newPassword"
            [showRequirements]="true"
          ></app-password-strength-indicator>
        }
      </div>

      <div class="field">
        <label for="confirmation">Confirmação da nova senha *</label>
        <div class="input-wrapper">
          <input
            id="confirmation"
            [type]="showConfirmation ? 'text' : 'password'"
            [(ngModel)]="confirmPassword"
            name="confirmation"
            placeholder="Confirme a nova senha"
            autocomplete="new-password"
          />
          <button
            class="eye-btn"
            type="button"
            (click)="toggleShowPassword('confirmation')"
          >
            <mat-icon>{{ showConfirmation ? 'visibility_off' : 'visibility' }}</mat-icon>
          </button>
        </div>
      </div>

      @if (error) {
        <p class="error">{{ error }}</p>
      }

      <div class="buttons">
        <button class="cancel-btn" type="button" (click)="onClose()">
          Fechar
        </button>

        <button class="confirm-btn" type="submit">
          Mudar senha
        </button>
      </div>
    </form>
  </div>
</div>