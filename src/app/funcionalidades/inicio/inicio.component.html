<!-- ========================================= 
     TÍTULO / HEADER
     ========================================= -->
<div class="titulo-container">
  <app-titulo [alinhamento]="'left'">Reels</app-titulo>

  <button class="ver-tudo" type="button" (click)="verTudo()">
    Ver tudo
    <mat-icon class="icone">arrow_forward</mat-icon>
  </button>
</div>

<!-- ========================================= 
     WEB / DESKTOP
     ========================================= -->
<div *ngIf="!isMobile" class="web">
  <app-carrossel>
    <div class="video-card" *ngFor="let video of videosReels">
      
      <!-- ✅ WRAPPER COM CAPA E PREVIEW -->
      <div 
        class="video-wrapper"
        (mouseenter)="aoPassarMouseVideo(video.id, $event)"
        (mouseleave)="aoSairMouseVideo(video.id, $event)"
        (click)="abrirModal(video)"
      >
        <!-- Capa (thumbnail) -->
        <img 
          [src]="video.capa" 
          [alt]="video.title"
          class="capa"
          [class.oculta]="mostrandoPrevia[video.id]"
        />
        
        <!-- Ícone play -->
        <div class="play-sobreposto" [class.oculto]="mostrandoPrevia[video.id]">
          <mat-icon>play_circle_filled</mat-icon>
        </div>
        
        <!-- Vídeo preview -->
        <video
          [src]="video.url"
          muted
          playsinline
          loop
          class="video-previa"
          [class.visivel]="mostrandoPrevia[video.id]"
        ></video>
      </div>

      <!-- Informações -->
      <div class="info-area">
        <h3>{{ video.title }}</h3>
        <p class="descricao">{{ video.description }}</p>
      </div>

      <!-- Comentários -->
      <div class="comentarios">
        <div class="cabecalho-comentario">
          <div class="titulo">Comentários</div>

          <app-botao-favoritar
            [favorito]="video.favorita ?? false"
            (aoClicar)="toggleFavorite(video.id)"
          ></app-botao-favoritar>
        </div>

        <span
          *ngIf="(comentariosState[video.id]?.length || 0) > 2"
          class="verTodos"
          (click)="abrirModal(video)"
        >
          Ver todos os {{ comentariosState[video.id].length }} comentários
        </span>

        <span *ngFor="let c of comentariosState[video.id]?.slice(-2)">
          {{ c }}
        </span>
      </div>

      <!-- Form comentário -->
      <div class="comentario-form">
        <input
          type="text"
          placeholder="Adicione um comentário..."
          [value]="novoComentario[video.id] || ''"
          (input)="novoComentario[video.id] = ($any($event.target).value)"
        />

        <button type="button" (click)="adicionarComentario(video.id)">
          Publicar
        </button>
      </div>
    </div>
  </app-carrossel>
</div>

<!-- ========================================= 
     MOBILE / CELULAR
     ========================================= -->
<div *ngIf="isMobile" class="mobile">
  <div class="lista-mobile">
    <div class="card-mobile" *ngFor="let video of videosReels">
      
      <!-- Vídeo mobile (só capa + clique) -->
      <div class="video-mobile-wrapper" (click)="abrirModal(video)">
        <img 
          [src]="video.capa" 
          [alt]="video.title"
          class="capa-mobile"
        />
        
        <div class="play-mobile">
          <mat-icon>play_circle_filled</mat-icon>
        </div>
      </div>

      <div class="info-mobile">
        <div class="linha-titulo">
          <h3 class="titulo-video">{{ video.title }}</h3>

          <app-botao-favoritar
            [favorito]="video.favorita ?? false"
            (aoClicar)="toggleFavorite(video.id)"
          ></app-botao-favoritar>
        </div>

        <p class="descricao-mobile">{{ video.description }}</p>

        <div class="comentarios-mobile">
          <span
            *ngIf="(comentariosState[video.id]?.length || 0) > 2"
            class="verTodos"
            (click)="abrirModal(video)"
          >
            Ver todos os {{ comentariosState[video.id].length }} comentários
          </span>

          <span *ngFor="let c of comentariosState[video.id]?.slice(-2)">
            {{ c }}
          </span>
        </div>

        <div class="comentario-form mobile-form">
          <input
            type="text"
            placeholder="Adicione um comentário..."
            [value]="novoComentario[video.id] || ''"
            (input)="novoComentario[video.id] = ($any($event.target).value)"
          />

          <button type="button" (click)="adicionarComentario(video.id)">
            Publicar
          </button>
        </div>
      </div>
    </div>
  </div>
</div>