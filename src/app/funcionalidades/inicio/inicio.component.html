<!-- Template do item (usado no carrossel por categoria) -->
<ng-template #videoItem let-video>
  <div class="video-card" [attr.id]="'video-' + video.id">
    <div
      class="video-wrapper"
      (mouseenter)="aoPassarMouseVideo(video.id, $event)"
      (mouseleave)="aoSairMouseVideo(video.id, $event)"
      (click)="abrirModal(video)"
    >
      <img
        [src]="video.capa"
        [alt]="video.title"
        class="capa"
        [class.oculta]="mostrandoPrevia[video.id]"
      />

      <div class="play-sobreposto" [class.oculto]="mostrandoPrevia[video.id]">
        <mat-icon>play_circle_filled</mat-icon>
      </div>

      <video
        [src]="video.url"
        muted
        playsinline
        loop
        class="video-previa"
        [class.visivel]="mostrandoPrevia[video.id]"
      ></video>
    </div>

    <div class="info-area">
      <h3>{{ video.title }}</h3>
      <p class="descricao">{{ video.description }}</p>
    </div>

    <div class="comentarios">
      <div class="cabecalho-comentario">
        <div class="titulo">Comentários</div>
        <app-botao-favoritar
          [favorito]="video.favorita ?? false"
          (aoClicar)="toggleFavorite(video.id)"
        ></app-botao-favoritar>
      </div>

      <span
        *ngIf="(comentariosState[video.id]?.length || 0) > 2"
        class="verTodos"
        (click)="abrirModal(video)"
      >
        Ver todos os {{ comentariosState[video.id].length }} comentários
      </span>

      <span *ngFor="let c of comentariosState[video.id]?.slice(-2)">
        {{ c }}
      </span>
    </div>

    <div class="comentario-form">
      <input
        type="text"
        placeholder="Adicione um comentário..."
        [value]="novoComentario[video.id] || ''"
        (input)="novoComentario[video.id] = ($any($event.target).value)"
      />
      <button type="button" (click)="adicionarComentario(video.id)">
        Publicar
      </button>
    </div>
  </div>
</ng-template>

<!-- Carrossel por categoria (web + mobile) -->
<div class="web">
 <app-categoria-carrossel
  *ngFor="let grupo of videosPorCategoria"
  [titulo]="grupo.nome"
  [itens]="grupo.itens"
  [itemTemplate]="videoItem"
  [attr.id]="'cat-' + grupo.nome.toLowerCase().replace(/\s+/g,'-')"
></app-categoria-carrossel>
</div>
